#!/usr/bin/env bash
# DigiHub UI helpers (colors + layout)
# Safe to source from any bash script.

# ---- Color helpers (auto-off if not a terminal / NO_COLOR set) ----
color_on=true
if [ ! -t 1 ] || [ -n "${NO_COLOR:-}" ]; then
  color_on=false
fi

c() { $color_on && tput "$@" || true; }

RESET="$(c sgr0)"
BOLD="$(c bold)"
DIM="$(c dim)"

FG_WHITE="$(c setaf 7)"
FG_CYAN="$(c setaf 6)"
FG_GREEN="$(c setaf 2)"
FG_YELLOW="$(c setaf 3)"
FG_RED="$(c setaf 1)"
FG_BLUE="$(c setaf 4)"

# Normal output styles
HEAD="${BOLD}${FG_CYAN}"
LABEL="${BOLD}${FG_WHITE}"
VALUE="${FG_WHITE}"
MUTED="${DIM}${FG_WHITE}"

# Error output styles
ERR_HEAD="${BOLD}${FG_RED}"
ERR_LABEL="${BOLD}${FG_WHITE}"
ERR_VALUE="${FG_WHITE}"

section() { # section "Title"
  printf "\n${BOLD}${FG_BLUE}%s${RESET}\n" "$1"
}

kv() { # kv "Label" "Value"
  printf "  ${LABEL}%-14s${RESET} ${VALUE}%s${RESET}\n" "$1" "${2:-N/A}"
}

err_section() { # err_section "Title"
  printf "\n${ERR_HEAD}%s${RESET}\n" "$1" >&2
}

err_kv() { # err_kv "Label" "Value"
  printf "  ${ERR_LABEL}%-14s${RESET} ${ERR_VALUE}%s${RESET}\n" "$1" "${2:-}" >&2
}

die() { # die "Title" "Message" [exit_code]
  local title="${1:-Error}"
  local msg="${2:-}"
  local code="${3:-1}"
  err_section "$title"
  [ -n "$msg" ] && err_kv "Message" "$msg"
  printf "\n" >&2
  exit "$code"
}

need_file() { # need_file "/path/to/file" "what to do"
  local f="$1"
  local action="${2:-}"
  if [ ! -r "$f" ]; then
    err_section "Configuration Missing"
    err_kv "File" "$f"
    [ -n "$action" ] && err_kv "Action" "$action"
    printf "\n" >&2
    exit 1
  fi
}

status_tag() {
  case "$1" in
    Active)
      printf "%sACTIVE%s" "$FG_GREEN" "$RESET"
      ;;
    Expired)
      printf "%sEXPIRED%s" "$FG_RED" "$RESET"
      ;;
    *)
      printf "%sUNKNOWN%s" "$FG_YELLOW" "$RESET"
      ;;
  esac
}
